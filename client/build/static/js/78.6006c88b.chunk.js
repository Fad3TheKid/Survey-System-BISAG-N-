"use strict";(self.webpackChunkformflow_client=self.webpackChunkformflow_client||[]).push([[78],{78:(e,r,t)=>{t.r(r),t.d(r,{default:()=>I});var s=t(5043),n=t(3216),l=t(1045),i=t(5865),a=t(6446),o=t(611),c=t(4194),d=t(2518),u=t(7348),x=t(8492),h=t(8577),m=t(4256),p=t(9413),j=t(1962),v=t(8483),f=t(7392),g=t(9070),A=t(1806),b=t(4882),y=t(8076),q=t(2420),k=t(3460),w=t(3336),S=t(155),C=t(4505),E=t(579);const F="formResponseAutosave";const I=function(){var e,r;const{formId:t}=(0,n.g)(),I=(0,n.Zp)(),[O,P]=(0,s.useState)(null),[W,R]=(0,s.useState)({}),[T,$]=(0,s.useState)(""),[D,L]=(0,s.useState)(!0),[U,z]=(0,s.useState)(null),[B,J]=(0,s.useState)(!1),[M,N]=(0,s.useState)({});(0,s.useEffect)((()=>{(async()=>{try{L(!0);const e=await C.mt.getForm(t);e.questions||(e.questions=[]),P(e);const r={};e.questions.forEach(((e,t)=>{switch(e.type){case"checkbox":r[t]=[];break;case"grid":r[t]={};break;case"file":r[t]=null;break;case"linear":r[t]=3;break;default:r[t]=""}}));const s=localStorage.getItem(F);if(s){const e=JSON.parse(s);e.formId===t&&(Object.entries(e.answers||{}).forEach((e=>{let[t,s]=e;r[t]=s})),e.email&&$(e.email))}R(r),z(null)}catch(e){z("Failed to load form. Please try again later."),console.error("Error loading form:",e)}finally{L(!1)}})()}),[t]),(0,s.useEffect)((()=>{if(!O)return;const e={formId:t,answers:W,email:T};localStorage.setItem(F,JSON.stringify(e))}),[W,T,t,O]);const _=()=>{localStorage.removeItem(F)},H=(e,r)=>{R((t=>({...t,[e]:r}))),N((r=>{const t={...r};return delete t[e],t}))},V=()=>{if(!O)return;const e={};O.questions.forEach(((r,t)=>{switch(r.type){case"checkbox":e[t]=[];break;case"grid":e[t]={};break;case"file":e[t]=null;break;case"linear":e[t]=3;break;default:e[t]=""}})),R(e),$(""),N({}),z(null),J(!1),_()},Y=e=>{if(!e)return null;if(e instanceof File){if(e.type.startsWith("image/")){const r=URL.createObjectURL(e);return(0,E.jsx)(l.A,{src:r,alt:e.name,variant:"rounded",sx:{width:56,height:56,mr:1}})}return(0,E.jsx)(i.A,{children:e.name})}return"string"===typeof e?(0,E.jsx)(i.A,{children:e}):null};if(D)return(0,E.jsx)(a.A,{sx:{p:4},children:(0,E.jsx)(o.A,{})});if(U&&!B)return(0,E.jsx)(c.A,{severity:"error",sx:{m:4},children:U});if(B)return(0,E.jsxs)(a.A,{sx:{maxWidth:600,mx:"auto",p:4,textAlign:"center"},children:[(0,E.jsx)(c.A,{severity:"success",sx:{mb:2},children:"Thank you for your response!"}),(0,E.jsx)(d.A,{variant:"contained",onClick:()=>I("/"),children:"Back to Home"}),(0,E.jsx)(d.A,{sx:{ml:2},color:"secondary",onClick:V,children:"Submit Another Response"})]});const Z=(e,r)=>{var t,s,n,l,o;const c=M[r];switch(e.type){case"short":return(0,E.jsx)(E.Fragment,{children:(0,E.jsx)(u.A,{fullWidth:!0,value:W[r]||"",onChange:e=>H(r,e.target.value),required:e.required,error:!!c,helperText:c})});case"paragraph":return(0,E.jsx)(u.A,{fullWidth:!0,multiline:!0,rows:4,value:W[r]||"",onChange:e=>H(r,e.target.value),required:e.required,error:!!c,helperText:c});case"multiple":return(0,E.jsxs)(x.A,{value:W[r]||"",onChange:e=>H(r,e.target.value),children:[null===(t=e.options)||void 0===t?void 0:t.map(((r,t)=>(0,E.jsx)(h.A,{value:r,control:(0,E.jsx)(m.A,{required:e.required}),label:r},t))),c&&(0,E.jsx)(i.A,{color:"error",variant:"body2",sx:{mt:.5},children:c})]});case"checkbox":return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(p.A,{children:null===(s=e.options)||void 0===s?void 0:s.map(((e,t)=>(0,E.jsx)(h.A,{control:(0,E.jsx)(j.A,{checked:(W[r]||[]).includes(e),onChange:()=>((e,r)=>{R((t=>{const s=t[e]||[];let n;return n=s.includes(r)?s.filter((e=>e!==r)):[...s,r],{...t,[e]:n}})),N((r=>{const t={...r};return delete t[e],t}))})(r,e)}),label:e},t)))}),c&&(0,E.jsx)(i.A,{color:"error",variant:"body2",sx:{mt:.5},children:c})]});case"file":return(0,E.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",gap:1,flexWrap:"wrap"},children:[(0,E.jsx)("input",{type:"file",onChange:e=>{const t=e.target.files[0];H(r,t)},required:e.required}),W[r]&&(0,E.jsxs)(a.A,{sx:{display:"flex",alignItems:"center"},children:[Y(W[r]),(0,E.jsx)(v.A,{title:"Remove file",children:(0,E.jsx)(f.A,{size:"small",onClick:()=>(e=>{H(e,null)})(r),children:(0,E.jsx)(S.A,{})})})]}),c&&(0,E.jsx)(i.A,{color:"error",variant:"body2",sx:{mt:.5},children:c})]});case"dropdown":return(0,E.jsx)(E.Fragment,{children:(0,E.jsxs)(u.A,{select:!0,SelectProps:{native:!0},value:W[r]||"",onChange:e=>H(r,e.target.value),required:e.required,error:!!c,helperText:c,children:[(0,E.jsx)("option",{value:"",disabled:!0,children:"Select..."}),null===(n=e.options)||void 0===n?void 0:n.map(((e,r)=>(0,E.jsx)("option",{value:e,children:e},r)))]})});case"linear":return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(g.Ay,{value:W[r]||3,min:e.scaleMin||1,max:e.scaleMax||5,step:1,marks:!0,valueLabelDisplay:"auto",onChange:(e,t)=>H(r,t),"aria-labelledby":"linear-scale-slider"}),c&&(0,E.jsx)(i.A,{color:"error",variant:"body2",sx:{mt:.5},children:c})]});case"grid":return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsxs)(A.A,{size:"small",sx:{maxWidth:600},children:[(0,E.jsx)(b.A,{children:(0,E.jsxs)(y.A,{children:[(0,E.jsx)(q.A,{}),null===(l=e.columns)||void 0===l?void 0:l.map(((e,r)=>(0,E.jsx)(q.A,{align:"center",children:e},r)))]})}),(0,E.jsx)(k.A,{children:null===(o=e.rows)||void 0===o?void 0:o.map(((t,s)=>(0,E.jsxs)(y.A,{children:[(0,E.jsx)(q.A,{children:t}),e.columns.map(((s,n)=>{var l;return(0,E.jsx)(q.A,{align:"center",children:(0,E.jsx)(m.A,{checked:(null===(l=W[r])||void 0===l?void 0:l[t])===s,onChange:()=>{const e={...W[r]||{}};e[t]=s,H(r,e)},value:s,name:`grid-${r}-${t}`,required:e.required})},n)}))]},s)))})]}),c&&(0,E.jsx)(i.A,{color:"error",variant:"body2",sx:{mt:.5},children:c})]});default:return(0,E.jsxs)(i.A,{children:["Unsupported question type: ",e.type]})}};return(0,E.jsx)(a.A,{sx:{maxWidth:700,mx:"auto",p:3},children:(0,E.jsxs)(w.A,{sx:{p:4},children:[(0,E.jsx)(i.A,{variant:"h4",gutterBottom:!0,children:O.title||"Form"}),(null===(e=O.settings)||void 0===e?void 0:e.description)&&(0,E.jsx)(i.A,{variant:"body1",sx:{mb:3},children:O.settings.description}),(0,E.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),z(null),(()=>{var e;if(!O)return!1;const r={};return O.questions.forEach(((e,t)=>{const s=W[t];if(e.required)if("checkbox"!==e.type||s&&0!==s.length)if("grid"===e.type){var n;Object.keys(s||{}).length!==((null===(n=e.rows)||void 0===n?void 0:n.length)||0)&&(r[t]=`Please answer all rows for the required question: "${e.title}"`)}else"checkbox"===e.type||"grid"===e.type||void 0!==s&&""!==s&&null!==s||(r[t]=`Please answer the required question: "${e.title}"`);else r[t]=`Please answer the required question: "${e.title}"`})),null!==(e=O.settings)&&void 0!==e&&e.collectEmail&&!T&&(r.email="Please provide your email address"),N(r),0===Object.keys(r).length})())try{const e=await Promise.all(Object.entries(W).map((async e=>{let[r,t]=e;const s=O.questions[r];return"file"===s.type&&t instanceof File?{questionId:s.id,value:t.name}:{questionId:s.id,value:t}}))),r={formId:t,answers:e,respondentEmail:T||void 0,submittedAt:(new Date).toISOString()};await C.mt.submitResponse(r),J(!0),z(null),_()}catch(r){z("Failed to submit response. Please try again later."),console.error("Error submitting response:",r)}},noValidate:!0,children:[(null===(r=O.settings)||void 0===r?void 0:r.collectEmail)&&(0,E.jsx)(u.A,{label:"Your Email",type:"email",fullWidth:!0,required:!0,value:T,onChange:e=>{$(e.target.value),N((e=>{const r={...e};return delete r.email,r}))},error:!!M.email,helperText:M.email,sx:{mb:3}}),O.questions.map(((e,r)=>(0,E.jsxs)(a.A,{sx:{mb:4},children:[(0,E.jsxs)(i.A,{variant:"h6",sx:{mb:1},children:[e.title," ",e.required&&"*"]}),Z(e,r)]},r))),U&&(0,E.jsx)(c.A,{severity:"error",sx:{mb:2},children:U}),(0,E.jsxs)(a.A,{sx:{display:"flex",gap:2},children:[(0,E.jsx)(d.A,{variant:"contained",type:"submit",children:"Submit"}),(0,E.jsx)(d.A,{variant:"outlined",color:"secondary",onClick:V,children:"Reset Form"})]})]})]})})}}}]);
//# sourceMappingURL=78.6006c88b.chunk.js.map